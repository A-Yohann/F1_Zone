{% extends 'base.html.twig' %}

{% block title %}F1-Zone Quiz F1{% endblock %}

{% block body %}
<section id="quiz-main" style="min-height: 80vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(120deg, #181818 0%, #232323 100%);">
    <div class="quiz-main-card">
        <h1>Quiz F1</h1>
        <p>Testez vos connaissances sur la Formule 1 !<br>Choisissez la difficulté pour commencer.</p>
        <form method="get" action="{{ path('app_quiz') }}" style="width:100%; max-width:340px; margin:2rem auto 0 auto;">
            <div class="mb-3">
                <label for="difficulte" class="form-label">Difficulté :</label>
                <select name="difficulte" id="difficulte" class="form-select" required>
                    <option value="facile" {% if difficulte == 'facile' %}selected{% endif %}>Facile</option>
                    <option value="moyen" {% if difficulte == 'moyen' %}selected{% endif %}>Moyen</option>
                    <option value="difficile" {% if difficulte == 'difficile' %}selected{% endif %}>Difficile</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary w-100">Lancer le quiz</button>
        </form>
        {% if showResult %}
            <div class="quiz-placeholder mt-4">
                <h3>Quiz terminé !</h3>
                <p>Votre score : <b>{{ score }}/{{ total }}</b></p>
                <a href="{{ path('app_quiz') }}" class="btn btn-secondary mt-3">Recommencer</a>
            </div>
        {% elseif difficulte and question %}
            <div class="quiz-placeholder mt-4">
                <div style="margin-bottom:1rem; font-size:1.1rem;">
                    Question {{ current + 1 }}/{{ total }}
                </div>
                {% if message %}
                    <div class="alert alert-info">{{ message }}</div>
                {% endif %}
                <form method="post" action="{{ path('app_quiz') }}">
                    <div class="mb-3">
                        <strong>{{ question.question }}</strong>
                    </div>
                    {% for reponse in reponses %}
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="reponse" id="reponse{{ loop.index }}" value="{{ reponse.id }}" required>
                            <label class="form-check-label" for="reponse{{ loop.index }}">
                                {{ reponse.reponse }}
                            </label>
                        </div>
                    {% endfor %}
                    <button type="submit" class="btn btn-success mt-3">Valider</button>
                </form>
            </div>
        {% elseif difficulte %}
            <div class="quiz-placeholder mt-4">
                <span>Aucune question trouvée pour cette difficulté.</span>
            </div>
        {% endif %}
        {% if showResult %}
        <hr class="my-4">
        <h2 style="text-align:center;">Classement détaillé</h2>
        <table class="table table-dark table-striped mt-4">
            <thead>
                <tr>
                    <th>Position</th>
                    <th>Utilisateur</th>
                    <th>Difficulté</th>
                    <th>Date</th>
                    <th>Bonnes réponses</th>
                    <th>Mauvaises réponses</th>
                    <th>Tentatives</th>
                </tr>
            </thead>
            <tbody>
                {% for row in classement %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row.username }}</td>
                        <td>{{ row.difficulte }}</td>
                        <td>{{ row.date }}</td>
                        <td>{{ row.nb_bonnes }}</td>
                        <td>{{ row.nb_mauvaises }}</td>
                        <td>{{ row.nb_tentatives }}</td>
                    </tr>
                {% else %}
                    <tr><td colspan="7">Aucun résultat</td></tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>
</section>
{% endblock %}
